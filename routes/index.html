<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="Description" content="simple HTML page for back-end-only eCommSQL"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.6.0/darkly/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
<title>e-Comm SQL</title>
</head>
<body>
<nav class="navbar navbar-expand navbar-light bg-warning text-light fixed-top py-0 my-0">
  <a class="navbar-brand" href="https://github.com/attila5287/e-commerce"> 
    <img alt="@attila5287" src="https://avatars1.githubusercontent.com/u/42498753?s=60&amp;u=739973fd70454aa533c67bccf17b6aeddcc6361f&amp;v=4" class="rounded-xl my-0 py-0" 
    width= "36" 
    height="36">
     </a>
  <button class="navbar-toggler" data-target="#my-nav" data-toggle="collapse" aria-controls="my-nav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div id="my-nav" class="collapse navbar-collapse">
    <ul class="navbar-nav mr-auto my-0 py-0">
      <li class="nav-item active">
        <a class="nav-link text-dark" href="http://ecommsql.herokuapp.com">
          <h4 class="text-primary">
            <u>
              <b class="font-italic text-dark">e-Commerce</b>
            </u>  
            <small class="font-italic ml-5">
              <b>
                node.js app with Sequelize ORM and MySQL dialect serving routes with express.js
              </b>
            </small>
          </h4>
          <span class="sr-only">(current)</span></a>
      </li>
    </ul>
  </div>
</nav>
<div class="mini">
  <hr class="mt-5">
  
  <h1 class="mt-5 text center">View Products</h1>
  <hr class="border-warning mt-0 mb-4">
          <div class="card-columns" id="products"></div>

  <h1 class="text center">
    <i class="fab fa-amazon fa-flip-horizontal text-warning">
    </i>
    <i>
      dd 
      Category
    </i>
  </h1>
  <hr class="border-warning mt-0 mb-4">
  <div class="row">
    <div class="col-6">
        <form method="POST" action="/api/categories">
          <label for="category_name">
            <h3 class="fas fa-th-large mr-2"></h3>
            Type a name for the new category
          </label>      
          <input class="form-control form-control-lg" type="text" name="category_name"  id="category_name" value="New Category">
          
          <input id="submit" class="btn btn-primary btn-block btn-lg mt-2" type="submit" name="submit" value="insert category to database">
        </form>
        <blockquote  class="blockquote mt-4">
          <i class="fas fa-database fa-pull-left mr-3"></i>
          fetching DB records...
          <small class="mb-0 text-muted font-italic" id="cats_saved">
          </small>
        </blockquote >
      </div>
      
      <div class="col-6">
        <form method="POST" action="/api/tags">
          <label for="tag_name">
            <h3 class="fas fa-tag mr-2"></h3>
            Type a name for the new tag
          </label>      
          <input class="form-control form-control-lg" type="text" name="tag_name" value="New Tag">
          
          <input id="submit" class="btn btn-primary btn-block btn-lg mt-2" type="submit" name="submit" value="insert tag to database">
        </form>
        <blockquote  class="blockquote mt-4">
        
          <i class="fas fa-database fa-pull-left mr-3"></i>
          fetching DB records...
          <small class="mb-0 text-muted font-italic" id="tags_saved">
          </small>
        
        </blockquote >
      </div>
  </div>
  
  <h1 class="mt-5 text center">
    <i class="fab fa-amazon fa-flip-horizontal text-warning"></i>
    <i>
      dd Product
    </i>
  </h1>
  <hr class="border-warning mt-0 mb-4">
  <form method="POST" action="/api/products">
    <div class="row">
      <div class="col-6">
        
        <div class="form-group">
          <label for="select_cat">
            <h3 class="fas fa-th-large mr-2"></h3>
            <span class="text-warning"> (Required) </span>
             Select Category</label>
          <select id="select_cat" class="custom-select" name="category_id">
            <option hidden>Please choose a category</option>
          </select>
        </div>
        <div class="form-group">
          <label for="select_tag">
            <h3 class="fas fa-tag mr-2"></h3>
            (Optional) Select Tag(s)</label>
          <select id="select_tag" class="custom-select custom-select-lg" name="tagIds" size="9" multiple>
            <option value="0" disabled>Multiple selection available</option>
          </select>
        </div>
      </div>
  
      <div class="col-6">
        
        <div class="form-group">
          <label for="product_name">
            <h3 class="fas fa-barcode mr-2"></h3>
            <span class="text-warning"> (Required) </span> Type Product Name</label>
          <input id= "product_name" class="form-control" type="text" name="product_name" value="New Product Name">
        </div>
        <div class="form-group">
          <label for="price">
            <h3 class="fas fa-hand-holding-usd mr-2"></h3>
            <span class="text-warning"> (Required) </span> Type Product Price ($/ea.)
          </label>
          <input id= "price" class="form-control" type="text" name="price" value="0">
        </div>
        <div class="form-group">
          <label for="stock">
            <h3 class="fas fa-boxes mr-2"></h3>
            <span class="text-warning"> (Required) </span> Type In-Stock Quantity (count)
          </label>
          <input id= "stock" class="form-control" type="text" name="stock" value="1">
        </div>
        <div class="form-group">
          <label for="img_url">
            <h3 class="fas fa-images mr-2"></h3>
            (Default/Set Later) Image URL
          </label>
          <input id= "img_url" class="form-control" type="text" name="img_url" value="https://raw.githubusercontent.com/attila5287/e-commerce/main/public/product_images/default.png">
        </div>
      </div>
  
      <input id="submit" class="btn btn-primary btn-block btn-lg col-12" type="submit" name="submit" value="insert product to database">
    </div>
  </form>
  
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script>

<style>
  
  .card-columns {
    column-count: 4;
  };
  .fas {
    color: orange;
  }
.mini {
  width: 100%;
  margin: auto;
  max-width: 736px;
  padding: 4px;
} 
  .card-img-top {
    max-height: 12rem;
  }

  .rounded-xl {
    border-radius: 0.75rem;
  }
  .text-sm{
    font-size: 0.85rem;

  }
  label {
    font-size: 1.25rem;
    font-style: italic;
  }
</style>

<script>
  $.ajax( {
    type: "GET",
    url: '/api/products',
  } ).then((products) => {
    console.log('products :>> ', products);
      products.forEach(p => {
          
        const card = $('<div>');
        card.attr('class', 'card bg-primary border-warning rounded-xl m-2');
        const header = $('<h6>');
        header.attr('data-toggle', "tooltip");
        header.attr('title', p.product_name);
        header.attr('class', 'card-header text-center bg-transparent border-bottom border-warning');

        header.text(p.product_name);  
        if (p.product_name.length > 25) {
        header.text(p.product_name.slice(0,25) + "...");  
          
        }

        const img = $('<img>');
        img.attr('class', 'card-img-top bg-dark');
        img.attr('src', p.img_url);
        img.text(p.product_name);  

        const body = $('<div>');
        body.attr('class', 'card-body bg-dark');
        
        const title = $('<h4>');
        title.attr('class', 'card-title text-center text-dark bg-warning rounded-lg');
        title.text('$ '+p.price+ '.00');  

        
        const text = $('<p>');
        text.attr('class', 'card-text font-italic text-right text-sm');
        text.text('no tags recorded');  
        if (p.tags) {
        text.text(p.tags.map(d=>d.tag_name.toLowerCase()).join(', '));  
        }
        
        const tag_icon =  $('<i>').attr('class', 'fas fa-tag ml-2')  
        text.append(tag_icon);    
        
        body.append(title);    
        body.append(text);

        const footer = $('<div>');
        footer.attr('class', 'card-footer bg-transparent border-warning border-top text-center text-warning py-0 mt-0');
        footer.text(p.category.category_name);  

        const cat_icon =  $('<small>').attr('class', 'fas fa-th-large ml-2')  
        footer.append(cat_icon);    
        
        const stock_icon =  $('<small>').attr('class', 'fas fa-boxes text-light ml-5')  
        stock_icon.text(p.stock);    
        footer.append(stock_icon);    
        
        card.append(header);  
        card.append(img);  
        card.append(body);  
        card.append(footer);  

        $('#products').append(card);
        
      });

    
  }).catch((err) => {
    console.log('err :>> ', err);
  });
</script>

<script>
  $.ajax({
    url: "/api/tags",
    success: function (tags) {
    let str = '';

    tags.forEach(t => {
      str = str + t.tag_name.toUpperCase() + ', '
    });  
    
    $('#tags_saved').text(str)      
    }
  });
  $.ajax({
    url: "/api/categories",
    success: function (cats) {
    let str = '';

    cats.forEach(c => {
      str = str + c.category_name.toUpperCase() + ', '
    });  
    
    $('#cats_saved').text(str)      
    }
  });
  
</script>

<script>
  $.ajax({
    type: "GET",
    url: "/api/categories/",
    dataType: "JSON",
    success: function (cats) {
      console.log('cats :>> ', cats);
      cats.forEach(c => {
        const opt = $('<option>');
        opt.attr('value', c.id);
        opt.text(c.category_name);
        $('#select_cat').append(opt);
      });
    }
  });
</script>

<script>
  $.ajax({
    type: "GET",
    url: "/api/tags",
    dataType: "JSON",
    success: function (tags) {
      tags.forEach(t => {
        const opt = $('<option>');
        opt.attr('value', t.id);
        opt.text(t.tag_name)
        $('#select_tag').append(opt)


      });
    }
  });
</script>
</body>
</html>
